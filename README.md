# 자취생의 냉장고
> 진행기간: 2022.10.31~2022.11.05
#### 목차
1. [개요](#1-개요)
2. [프로젝트 내용](#2-프로젝트-내용)
3. [개인적인 회고](#3-개인적인-회고)

## 1. 개요
**요약**   
자취생의 냉장고는 희망하는 조리 시간과 냉장고에 남은 재료들을 입력하면 해당 재료들로 만들 수 있는 간단한 요리 레시피를 추천하는 서비스
서비스에 제공되는 레시피들에 대한 데이터를 대시보드 형태로 제공하여, 자취 요리 레시피들 중 가장 인기있는 요리 등을 확인할 수 있다.

**성과**: ETL프로세스(수집, 적재부터 로드하여 모델 훈련시키고 프론트앤드로 구축하여 배포까지) 전반과 머신러닝 프로세스를 End to end로 경험해볼 수 있었다. 간단하게 프론트를 구현하고 모델을 웹 상에서 작동하도록 하면서 생겨나는 다양한 난관을 극복했다.

### 1.1 기획 동기 및 의도
- 프로젝트 첫째 날 기존에 준비하던 주제가 구현이 불가함을 깨닳고 하루 종일 주제를 바꾸고 데이터 탐색을 반복하다가 저녁시간이 되었다. 배가 고팠지만 끼니를 대충 해결하고자 하였고, 무슨 매뉴를 먹어야 할 지 고민하다가 탄생하였다.
- 필자는 자취생이 아니지만, 집에서 자주 직접 요리를 하여 끼니를 해결해야 하고, 식사를 위해 장을 따로 보지 않아 냉장고에 남은 재료로 요리를 자주 하는 편이다. 레시피를 확인 할 때마다 주 재료로 레시피를 검색하나, 없는 재료들이 포함된 레시피들을 걸러내는데 시간이 아깝다고 생각했다.

## 2. 프로젝트 내용
### 2.1 발표자료
![image](https://user-images.githubusercontent.com/83063287/216822157-7384c7aa-5745-4038-bd19-6c97d4dec6c3.png)
![image](https://user-images.githubusercontent.com/83063287/216822161-fb27343f-f1e2-43c5-9a62-cb0aeb0214d7.png)
![image](https://user-images.githubusercontent.com/83063287/216822164-a5022b5d-1c41-44fb-97f4-cf4dd9f95484.png)
![image](https://user-images.githubusercontent.com/83063287/216822165-4296aa42-201d-4f55-be1a-f6df49785eb5.png)
![image](https://user-images.githubusercontent.com/83063287/216822166-67744739-7b01-4dd3-961b-b3bdeb1969d3.png)
![image](https://user-images.githubusercontent.com/83063287/216822171-14ce7a90-44fb-44df-adc0-21fcad7c17d1.png)
![image](https://user-images.githubusercontent.com/83063287/216822173-97065aef-5605-41b9-8d4b-6aaf1952146c.png)
![image](https://user-images.githubusercontent.com/83063287/216822175-83531f41-5977-4038-b911-d4f3abbce7ee.png)

### 2.2 학습 데이터
* 만개의 레시피 스크레핑(직접 진행)

### 2.3 사용 기술
- [Model] 추천알고리즘 : 콘텐츠 기반 협업필터링 & NLP전처리
- [DB] MySQL & MongoDB
- [Dashboard] Metabase (with Docker)
- [Scraping] BS4 & request

### 2.4 Pipeline
![image](https://user-images.githubusercontent.com/83063287/210044508-21fc985e-4d19-488d-a06c-0bd96c0287d9.png)   

#### 1) [만개의 레시피](https://www.10000recipe.com/) 사이트 스크레핑
- Request & BeautifulSoup 라이브러리를 활용하여 각 레시피의 레시피명, Serving, 조리시간 등을 스크래핑
- time.sleep()을 각 레시피 수집 당 1초로 설정하여 IP 주소 차단을 방지
- 약 4000개의 레시피를 실시간으로 MongoDB 적재[8시간 소요] (SQL에 비해 유연하여 원본데이터를 적재하기 용이)
- 분석 및 훈련에 적절한 형태로 가공하여 MySQL Server에 저장   

#### 2) 레시피 재료 임베딩
- Word2Vec으로 NLP 모델 훈련 (수정하기)
- Count Vectorize 기반 재료간 유사성 계산(Cosine Similarity)
- 기존 카운트기반 벡터화방식을 이진값으로(0: 없음, 1: 있음)으로 활용 - 재료가 반복되어도 중요도가 올리가지 않음

#### 3) 콘텐츠 기반 필터링 알고리즘 이용한 레시피 추천   
- 사용자 입력값(냉장고 남은 재료)와 저장된 레시피 재료들간의 코사인 유사도를 계산하여 높은 순서로 30개 레시피 필터링
- 여기서 사용자가 희망 조리시간을 설정한 경우 해당 조리시간 이내의 레시피를 필터링
- 마지막으로 레시피 자체의 조회수에 따라 정렬한 후 조회수 상위 10개 레시피를 추천

#### 4) Model Serving & 대시보드 생성 및 배포
- 모델을 피클링하여 Flask에 구현 
- 대시보드는 Metabase를 iframe 형태로 HTML에 추가 (다만 Docker로 Metabase를 호스팅하여 로컬에서만 작동)
- Heroku를 통한 배포

## 3. 개인적인 회고
**좋았던 점**   
- 끈질긴 노력(8시간) 끝에 Heroku 배포까지 성공! ~~(1달 뒤 무료 서비스 종료로 사라졌다고 한다...)~~
- 눈으로 작동되는 추천알고리즘을 구현해볼 수 있었다.

**어려웠던 점 & 극복**
- 단어 임베딩에 있어 NLP를 배우지 않은 상태에서 진행하다보니 서툴렀다.
- 재료를 임베딩할 때 기존 Count기반 방식은 이 프로젝트에 조금 부적절했는데 (재료가 반복된다고 중요도가 높아지면 안되므로), 이는 0, 1로만 output값이 나오도록 조정하여 해결하였다.
- 추천 알고리즘을 선택하는 것에 있어 협업필터링 방식과 사용자기반 추천 방식 중 고민되었으나, 이 둘을 조합하여 사용자 인풋 값에 따라 다른 레시피들과 유사도를 기반으로 추천하는 알고리즘을 고안했다.
- 추천 알고리즘은 기존에 배운 라이브러리에 모델이 없어, 이를 피클링하는데 어려움이 있었다. 이 부분은 DB에 저장된 레시피들의 임베딩을 완료한 후 Custom class로 model 객체를 만들어 피클링한 뒤, 유저 인풋 배열에 대해서만 벡터화하는 방식으로 극복(?) 하였다.

**보완이 필요한 점**    
- 아쉬운점은 협업필터링이라는 알고리즘 이름에 맞게, 구현한 모델자체는 어떤 데이터를 훈련한다기보다 필터링을 하는 알고리즘에 가깝다는 것이다.
- 그래서 사실 '학습'을 한다고 말할 수 있는 부분은 사용자 입력값을 백터화하여 다른 레시피들과 코사인 유사도를 계산하는 부분으로 생각된다.
- 다만, 벡터 유사도를 계산 할 때 토큰화가 제대로 되어있지 않아 보완이 필요하다. (NLP 배우기 이전이라 텍스트 데이터 토큰화 미흡)
   
**What I learned & 1달 전 나보다 발전한 것?**   
- 스크래핑은 동적이든 정적이든 자유자재로 할 수 있다. (적재는 MongoDB 짱짱짱)
- 데이터 수집부터 모델서빙, 배포까지 한사이클을 다 돌았다. (6일만에) 이젠 아이디어만 있다면 어떤 서비스를 만들 수 있을 것 같다.
- 대시보드를 구축할 수 있다.
- 도커를 쪼오오금 다룰 수 있다. 
- 디버깅 실력이 늘었다.

**더 배우고 싶은 점 :**   
- 대시보드 배포
- 이용자 Post 값 DB저장
- 다른 추천 시스템
